<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>++ Runner — "First Off" Mini-Game Prototype</title>
  <style>html,body{margin:0;height:100%}#game{width:100%;height:100vh;display:block}</style>
  <!-- Phaser 3 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
  <div id="game"></div>

  <!--
    How to use:
    1) Replace the placeholder assets in /assets and update keys in the preload() method.
    2) Open this file in a modern browser (desktop or mobile). For local file loading of audio
       you may need to run a simple local server (python -m http.server) due to browser
       security restrictions.
    3) Controls: on desktop use SPACE or UP to jump, LEFT/RIGHT to move slightly. On mobile
       tap anywhere to jump, swipe down to perform a brake (optional).

    Notes about content: you requested "homeless people" as level objects. To avoid
    dehumanizing real people, the prototype uses neutral NPC sprites called "street_npc".
    If you'd like a different theme (sleeping residents, cardboard figures, vendors,
    animated mannequins) tell me and I'll swap them.
  -->

  <script>
  // Replace these keys/paths with your sprite files and audio.
  const ASSETS = {
    playerSheet: { key: 'player', path: 'assets/player.png', frameWidth: 64, frameHeight: 64 },
    tireekSprite: { key: 'tireek', path: 'assets/tireek.png', frameWidth: 64, frameHeight: 64 },
    trystonSprite: { key: 'tryston', path: 'assets/tryston.png', frameWidth: 64, frameHeight: 64 },
    bg: { key: 'bg', path: 'assets/brooklyn_bg.png' },
    garbage: { key: 'garbage', path: 'assets/garbage.png' },
    npc: { key: 'npc', path: 'assets/street_npc.png' },
    vinyl: { key: 'vinyl', path: 'assets/vinyl.png' },
    fragment: { key: 'fragment', path: 'assets/fragment.png' },
    music: { key: 'song', path: 'assets/first_off.mp3' }
  };

  class Boot extends Phaser.Scene {
    constructor(){ super('Boot') }
    preload(){
      // load placeholders
      this.load.image(ASSETS.bg.key, ASSETS.bg.path);
      this.load.spritesheet(ASSETS.playerSheet.key, ASSETS.playerSheet.path, { frameWidth: ASSETS.playerSheet.frameWidth, frameHeight: ASSETS.playerSheet.frameHeight });
      this.load.spritesheet(ASSETS.tireekSprite.key, ASSETS.tireekSprite.path, { frameWidth: ASSETS.tireekSprite.frameWidth, frameHeight: ASSETS.tireekSprite.frameHeight });
      this.load.spritesheet(ASSETS.trystonSprite.key, ASSETS.trystonSprite.path, { frameWidth: ASSETS.trystonSprite.frameWidth, frameHeight: ASSETS.trystonSprite.frameHeight });
      this.load.image(ASSETS.garbage.key, ASSETS.garbage.path);
      this.load.image(ASSETS.npc.key, ASSETS.npc.path);
      this.load.image(ASSETS.vinyl.key, ASSETS.vinyl.path);
      this.load.image(ASSETS.fragment.key, ASSETS.fragment.path);
      this.load.audio(ASSETS.music.key, ASSETS.music.path);
    }
    create(){
      this.scene.start('Play');
    }
  }

  class Play extends Phaser.Scene {
    constructor(){ super('Play'); this.playerChoice = 'tireek'; }
    create(){
      // background and parallax
      this.bg = this.add.tileSprite(0,0,this.scale.width,this.scale.height, ASSETS.bg.key).setOrigin(0).setScrollFactor(0);

      // physics world
      this.physics.world.setBounds(0,0,100000, this.scale.height);

      // road/platform
      this.ground = this.add.tileSprite(0,this.scale.height-96,this.scale.width,96,'').setOrigin(0);

      // player
      this.player = this.physics.add.sprite(100, this.scale.height-150, ASSETS.tireekSprite.key).setScale(1).setSize(40,56).setOffset(12,8);
      this.player.setCollideWorldBounds(true);
      this.player.setGravityY(1200);

      // simple animations
      this.anims.create({ key: 'run', frames: this.anims.generateFrameNumbers(ASSETS.playerSheet.key, { start:0, end:7 }), frameRate:14, repeat:-1 });
      this.player.play('run');

      // camera follows player
      this.cameras.main.startFollow(this.player, true, 0.08, 0.08);
      this.cameras.main.setBounds(0,0,100000,this.scale.height);

      // groups
      this.obstacles = this.physics.add.group();
      this.vinyls = this.physics.add.group();
      this.fragments = this.physics.add.group();

      // collisions
      this.physics.add.collider(this.player, this.obstacles, this.hitObstacle, null, this);
      this.physics.add.overlap(this.player, this.vinyls, this.hitVinyl, null, this);
      this.physics.add.overlap(this.player, this.fragments, this.collectFragment, null, this);

      // input
      this.cursors = this.input.keyboard.createCursorKeys();
      this.input.on('pointerdown', ()=> this.tryJump());

      // generate level pieces periodically
      this.nextX = 400;
      this.levelTimer = this.time.addEvent({ delay: 800, callback: this.spawnLevelSegment, callbackScope: this, loop: true });

      // audio
      this.song = this.sound.add(ASSETS.music.key, { loop:true, volume:0.5 });
      // don't autoplay to respect browser rules — play when user first interacts
      this.firstInteract = false;

      // HUD
      this.fragCount = 0;
      this.fragText = this.add.text(16,16,'Fragments: 0',{font:'18px Arial', fill:'#ffffff'}).setScrollFactor(0);

      // simple win condition: collect 1 fragment
      this.win = false;
    }

    tryJump(){
      if(!this.firstInteract){ this.song.play(); this.firstInteract = true; }
      if(this.player.body.touching.down || this.player.body.onFloor()){
        this.player.setVelocityY(-520);
      } else if (this.player.body.velocity.y > -200){
        // double-jump small window
        this.player.setVelocityY(-480);
      }
    }

    spawnLevelSegment(){
      // spawn a random obstacle or vinyl or npc
      const typeRoll = Phaser.Math.Between(1,100);
      const y = this.scale.height - 120;
      if(typeRoll <= 45){
        // garbage can obstacle
        const g = this.obstacles.create(this.nextX, y, ASSETS.garbage.key);
        g.setImmovable(true); g.body.allowGravity = false;
      } else if(typeRoll <= 75){
        // npc (neutral) that sits on ground
        const n = this.obstacles.create(this.nextX, y, ASSETS.npc.key);
        n.setImmovable(true); n.body.allowGravity = false;
      } else if(typeRoll <= 95){
        // spinning vinyl that moves up/down
        const v = this.vinyls.create(this.nextX, y-80, ASSETS.vinyl.key);
        v.setCircle(v.width/2);
        v.setVelocityY(Phaser.Math.Between(-80,80));
        v.setAngularVelocity(150);
        v.body.allowGravity = false;
      } else {
        // fragment (rare)
        const f = this.fragments.create(this.nextX, y-120, ASSETS.fragment.key);
        f.body.allowGravity = false;
      }
      this.nextX += Phaser.Math.Between(200,420);

      // move everything left to simulate running world speed
      this.obstacles.children.iterate(o=>{ o.x -= 2; if(o.x < this.cameras.main.scrollX-200) o.destroy(); });
      this.vinyls.children.iterate(v=>{ v.x -= 2; if(v.x < this.cameras.main.scrollX-200) v.destroy(); });
      this.fragments.children.iterate(f=>{ f.x -= 2; if(f.x < this.cameras.main.scrollX-200) f.destroy(); });

      // scroll background
      this.bg.tilePositionX = this.cameras.main.scrollX * 0.5;
      // move player forward slowly to create momentum
      if(!this.win) this.player.setVelocityX(160);
    }

    hitObstacle(player, obstacle){
      // small stun effect: slow player, flash
      this.cameras.main.shake(120,0.01);
      player.setTint(0xff9999);
      this.time.delayedCall(400, ()=> player.clearTint());
      player.setVelocityX(60);
    }

    hitVinyl(player, vinyl){
      // contact with vinyl hurts more
      this.cameras.main.shake(200,0.02);
      this.sound.play(ASSETS.music.key, { volume: 0.1 });
      player.setVelocityY(-300);
    }

    collectFragment(player, fragment){
      fragment.destroy();
      this.fragCount++;
      this.fragText.setText('Fragments: ' + this.fragCount);
      if(this.fragCount >= 1 && !this.win){
        this.win = true;
        this.onWin();
      }
    }

    onWin(){
      // stop spawning and show end screen
      this.levelTimer.remove(false);
      this.player.setVelocityX(0);
      this.add.text(this.cameras.main.scrollX + this.scale.width/2 - 140, this.scale.height/2 - 40, 'You collected the fragment!', {font:'28px Arial', fill:'#ffffff'}).setScrollFactor(0);
      this.add.text(this.cameras.main.scrollX + this.scale.width/2 - 120, this.scale.height/2 + 10, 'Now play "First Off"', {font:'20px Arial', fill:'#ffff88'}).setScrollFactor(0);
    }

    update(time,delta){
      // basic controls for desktop
      if(this.cursors.up.isDown) this.tryJump();
      if(this.cursors.left.isDown) this.player.x -= 3;
      if(this.cursors.right.isDown) this.player.x += 3;

      // make vinyls rotate continuously
      this.vinyls.children.iterate(v=>{ v.angle += 4; });

      // recycle camera bounds for far scroll
      if(this.cameras.main.scrollX > 95000){
        this.cameras.main.setBounds(0,0,1000000,this.scale.height);
      }
    }
  }

  const config = {
    type: Phaser.AUTO,
    parent: 'game',
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#111111',
    physics: { default: 'arcade', arcade: { debug: false } },
    scene: [Boot, Play],
    scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH }
  };

  const game = new Phaser.Game(config);

  // Responsive to resize
  window.addEventListener('resize', ()=> { game.scale.resize(window.innerWidth, window.innerHeight); });
  </script>
</body>
</html>
