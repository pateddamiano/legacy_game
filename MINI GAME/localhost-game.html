<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>First Off - Brooklyn Street Mini Game (Localhost)</title>
    
    <!-- Localhost optimizations -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Game meta information -->
    <meta name="description" content="First Off - Brooklyn Street Mini Game running on localhost. Play as Tireek and Tryston in this hip-hop inspired street runner!">
    <meta name="keywords" content="localhost, game, brooklyn, street, mini-game, html5, canvas, javascript, development">
    <meta name="author" content="++ Game Studio">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            min-height: 100vh;
        }
        
        /* Development header */
        .dev-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 5px 15px;
            font-size: 14px;
            z-index: 2000;
            text-align: center;
            border-bottom: 2px solid #c0392b;
        }
        
        .dev-header .status {
            display: inline-block;
            margin: 0 10px;
        }
        
        .dev-header .status.online::before {
            content: "üü¢ ";
        }
        
        .dev-header .status.offline::before {
            content: "üî¥ ";
        }
        
        #gameContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 50px 10px 10px 10px; /* Account for dev header */
        }
        
        canvas {
            border: 3px solid #e74c3c;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(231, 76, 60, 0.5);
            max-width: calc(100vw - 20px);
            max-height: calc(100vh - 80px); /* Account for dev header */
            background: #2c3e50;
        }
        
        .game-info {
            position: fixed;
            top: 60px; /* Below dev header */
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #e74c3c;
            max-width: 350px;
            font-size: 13px;
            z-index: 1500;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
        }
        
        .game-info h3 {
            color: #e74c3c;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .game-info ul {
            list-style: none;
            padding: 0;
        }
        
        .game-info li {
            margin: 4px 0;
            color: #ecf0f1;
        }
        
        .game-info .key {
            background: #34495e;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
            color: #f1c40f;
            font-size: 11px;
        }
        
        .dev-info {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #34495e;
        }
        
        .dev-info .dev-item {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
            font-size: 11px;
        }
        
        .dev-info .dev-label {
            color: #95a5a6;
        }
        
        .dev-info .dev-value {
            color: #3498db;
        }
        
        .toggle-info {
            position: fixed;
            top: 60px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1501;
            font-size: 12px;
        }
        
        .toggle-info:hover {
            background: #c0392b;
        }
        
        .performance-monitor {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #3498db;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            z-index: 1500;
            border: 1px solid #34495e;
        }
        
        .error-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(231, 76, 60, 0.95);
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            text-align: center;
            padding: 20px;
        }
        
        .error-content h2 {
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .error-content button {
            margin: 10px;
            padding: 10px 20px;
            background: white;
            color: #e74c3c;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .error-content button:hover {
            background: #f8f9fa;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2500;
            text-align: center;
        }
        
        .loading-content h2 {
            margin-bottom: 20px;
            color: #e74c3c;
        }
        
        .loading-bar {
            width: 300px;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px auto;
        }
        
        .loading-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #f39c12);
            width: 0%;
            animation: loadingAnimation 3s ease-in-out forwards;
        }
        
        @keyframes loadingAnimation {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        @media (max-width: 768px) {
            .game-info {
                font-size: 11px;
                max-width: 280px;
                padding: 10px;
            }
            
            .game-info h3 {
                font-size: 14px;
            }
            
            .dev-header {
                font-size: 12px;
                padding: 3px 10px;
            }
            
            #gameContainer {
                padding-top: 40px;
            }
            
            .game-info {
                top: 45px;
            }
            
            .toggle-info {
                top: 45px;
                padding: 6px 10px;
                font-size: 11px;
            }
        }
        
        @media (max-width: 480px) {
            .game-info {
                display: none;
            }
            
            .performance-monitor {
                bottom: 5px;
                right: 5px;
                font-size: 10px;
                padding: 5px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Development Header -->
    <div class="dev-header">
        <span class="status" id="serverStatus">üü¢ Local Server Active</span>
        <span class="status" id="gameStatus">üéÆ First Off Game</span>
        <span class="status" id="urlStatus">üìç http://localhost:8080</span>
        <span class="status" id="devMode">üîß Development Mode</span>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <h2>Loading Brooklyn Streets...</h2>
            <div class="loading-bar">
                <div class="loading-fill"></div>
            </div>
            <p>Initializing First Off Game Engine</p>
        </div>
    </div>
    
    <!-- Game Container -->
    <div id="gameContainer">
        <!-- Game canvas will be inserted here by JavaScript -->
    </div>
    
    <!-- Game Info Panel -->
    <div class="game-info" id="gameInfo">
        <h3>üéÆ First Off - Controls</h3>
        <ul>
            <li><span class="key">‚Üê ‚Üí</span> Move left/right</li>
            <li><span class="key">‚Üë</span> Jump</li>
            <li><span class="key">SPACE</span> Switch character</li>
            <li><span class="key">ENTER</span> Super move</li>
            <li><span class="key">P</span> Pause/Resume</li>
            <li><span class="key">R</span> Restart</li>
            <li><span class="key">H</span> Toggle this panel</li>
        </ul>
        
        <h3>üéØ Characters</h3>
        <ul>
            <li><span style="color: #3498db;">‚óè</span> <strong>Tireek</strong> - Powerful Punch</li>
            <li><span style="color: #e67e22;">‚óè</span> <strong>Tryston</strong> - Knockback Yell</li>
        </ul>
        
        <h3>‚ö° Game Elements</h3>
        <ul>
            <li>üéµ Spinning vinyl records</li>
            <li>üë§ Gangster enemies (purple)</li>
            <li>üö∂ Homeless blockers (gray)</li>
            <li>üé§ Microphones (power-ups)</li>
        </ul>
        
        <div class="dev-info">
            <h3>üîß Development Info</h3>
            <div class="dev-item">
                <span class="dev-label">Server:</span>
                <span class="dev-value" id="serverType">Detecting...</span>
            </div>
            <div class="dev-item">
                <span class="dev-label">Port:</span>
                <span class="dev-value" id="serverPort">8080</span>
            </div>
            <div class="dev-item">
                <span class="dev-label">Game State:</span>
                <span class="dev-value" id="gameState">Loading</span>
            </div>
            <div class="dev-item">
                <span class="dev-label">FPS:</span>
                <span class="dev-value" id="fpsCounter">--</span>
            </div>
            <div class="dev-item">
                <span class="dev-label">Resolution:</span>
                <span class="dev-value" id="resolution">800x600</span>
            </div>
        </div>
        
        <p style="margin-top: 10px; font-size: 11px; color: #7f8c8d;">
            <strong>Goal:</strong> Survive 3 minutes to collect the song fragment!
        </p>
    </div>
    
    <!-- Toggle Info Button -->
    <button class="toggle-info" onclick="toggleInfo()">‚ÑπÔ∏è INFO</button>
    
    <!-- Performance Monitor -->
    <div class="performance-monitor" id="performanceMonitor">
        FPS: <span id="fpsDisplay">--</span> | 
        Memory: <span id="memoryDisplay">--</span>
    </div>
    
    <!-- Error Overlay -->
    <div class="error-overlay" id="errorOverlay">
        <div class="error-content">
            <h2>üö® Game Loading Error</h2>
            <p id="errorMessage">Failed to load the game engine.</p>
            <div>
                <button onclick="location.reload()">üîÑ Reload Game</button>
                <button onclick="checkServer()">üîß Check Server</button>
                <button onclick="hideError()">‚úñÔ∏è Dismiss</button>
            </div>
        </div>
    </div>
    
    <!-- Load Updated Game Engine -->
    <script src="first-off-game-updated.js"></script>
    
    <script>
        // Development environment setup
        let gameLoaded = false;
        let infoVisible = true;
        let fpsCounter = 0;
        let lastFpsUpdate = 0;
        let frameCount = 0;
        
        // Development configuration
        const DEV_CONFIG = {
            autoHideInfoDelay: 15000, // Auto-hide info panel after 15 seconds on mobile
            performanceUpdateInterval: 1000, // Update performance stats every second
            serverCheckInterval: 5000, // Check server status every 5 seconds
            errorRetryDelay: 3000 // Retry loading after error in 3 seconds
        };
        
        // Initialize development environment
        function initDevelopmentEnvironment() {
            detectServerType();
            updateGameState('Initializing');
            setupPerformanceMonitoring();
            setupErrorHandling();
            setupKeyboardShortcuts();
            
            // Auto-hide info panel on mobile
            if (window.innerWidth <= 768) {
                setTimeout(() => {
                    if (infoVisible && gameLoaded) {
                        toggleInfo();
                    }
                }, DEV_CONFIG.autoHideInfoDelay);
            }
        }
        
        // Detect server type
        function detectServerType() {
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    const serverType = data.server || 'Node.js';
                    document.getElementById('serverType').textContent = serverType;
                    document.getElementById('serverStatus').innerHTML = 'üü¢ ' + serverType + ' Server';
                })
                .catch(() => {
                    document.getElementById('serverType').textContent = 'Unknown';
                    document.getElementById('serverStatus').innerHTML = 'üü° Server Status Unknown';
                });
        }
        
        // Performance monitoring
        function setupPerformanceMonitoring() {
            setInterval(updatePerformanceStats, DEV_CONFIG.performanceUpdateInterval);
        }
        
        function updatePerformanceStats() {
            // FPS calculation
            const now = performance.now();
            if (now - lastFpsUpdate >= 1000) {
                const fps = Math.round((frameCount * 1000) / (now - lastFpsUpdate));
                document.getElementById('fpsCounter').textContent = fps;
                document.getElementById('fpsDisplay').textContent = fps;
                frameCount = 0;
                lastFpsUpdate = now;
            }
            frameCount++;
            
            // Memory usage (if available)
            if (performance.memory) {
                const memory = Math.round(performance.memory.usedJSHeapSize / 1048576);
                document.getElementById('memoryDisplay').textContent = memory + 'MB';
            } else {
                document.getElementById('memoryDisplay').textContent = 'N/A';
            }
            
            // Update resolution
            if (window.firstOffGame && window.firstOffGame.canvas) {
                const canvas = window.firstOffGame.canvas;
                document.getElementById('resolution').textContent = `${canvas.width}x${canvas.height}`;
            }
        }
        
        // Error handling
        function setupErrorHandling() {
            window.addEventListener('error', (e) => {
                console.error('Game error:', e.error);
                if (!gameLoaded) {
                    showError('JavaScript Error: ' + e.message);
                }
            });
            
            // Check for game loading after timeout
            setTimeout(() => {
                if (!gameLoaded && !window.firstOffGame) {
                    showError('Game failed to load. Please check the console for errors.');
                }
            }, 5000);
        }
        
        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.key === 'h' || e.key === 'H') {
                    if (e.ctrlKey || e.metaKey) return; // Don't interfere with browser shortcuts
                    toggleInfo();
                    e.preventDefault();
                }
            });
        }
        
        // UI functions
        function toggleInfo() {
            const info = document.getElementById('gameInfo');
            infoVisible = !infoVisible;
            info.style.display = infoVisible ? 'block' : 'none';
            
            const button = document.querySelector('.toggle-info');
            button.textContent = infoVisible ? '‚ÑπÔ∏è HIDE' : '‚ÑπÔ∏è INFO';
        }
        
        function updateGameState(state) {
            document.getElementById('gameState').textContent = state;
            if (window.firstOffGame) {
                document.getElementById('gameState').textContent = window.firstOffGame.gameState;
            }
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorOverlay').style.display = 'flex';
        }
        
        function hideError() {
            document.getElementById('errorOverlay').style.display = 'none';
        }
        
        function checkServer() {
            fetch('/health')
                .then(response => response.json())
                .then(data => {
                    alert('Server is running! Game: ' + data.game + ' | Status: ' + data.status);
                })
                .catch(error => {
                    alert('Server check failed: ' + error.message + '\nPlease ensure the server is running on port 8080.');
                });
        }
        
        // Game lifecycle
        window.addEventListener('load', () => {
            initDevelopmentEnvironment();
            
            // Hide loading screen after game loads
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loadingOverlay');
                if (window.firstOffGame) {
                    gameLoaded = true;
                    loadingOverlay.style.display = 'none';
                    updateGameState('Ready');
                    
                    // Update game state periodically
                    setInterval(() => {
                        if (window.firstOffGame) {
                            updateGameState(window.firstOffGame.gameState);
                        }
                    }, 500);
                    
                } else {
                    loadingOverlay.style.display = 'none';
                    showError('Game engine failed to initialize. Check console for details.');
                }
            }, 3000);
        });
        
        // Prevent context menu on canvas
        document.addEventListener('contextmenu', (e) => {
            if (e.target.tagName === 'CANVAS') {
                e.preventDefault();
            }
        });
        
        // Touch event optimization
        document.addEventListener('touchstart', function(e) {
            if (e.target.tagName === 'CANVAS') {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchmove', function(e) {
            if (e.target.tagName === 'CANVAS') {
                e.preventDefault();
            }
        }, { passive: false });
        
        // Server status monitoring
        setInterval(() => {
            fetch('/health')
                .then(response => {
                    if (response.ok) {
                        document.getElementById('serverStatus').innerHTML = 'üü¢ Server Online';
                    } else {
                        document.getElementById('serverStatus').innerHTML = 'üü° Server Issues';
                    }
                })
                .catch(() => {
                    document.getElementById('serverStatus').innerHTML = 'üî¥ Server Offline';
                });
        }, DEV_CONFIG.serverCheckInterval);
        
        console.log('üéÆ First Off Game - Development Environment Loaded');
        console.log('üîß Development features:');
        console.log('   - Press H to toggle info panel');
        console.log('   - Real-time FPS monitoring');
        console.log('   - Server status checking');
        console.log('   - Error handling and recovery');
        console.log('   - Performance statistics');
    </script>
</body>
</html>